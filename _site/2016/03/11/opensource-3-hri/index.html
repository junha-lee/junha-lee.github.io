<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no"/>


<title>kakao의 오픈소스 Ep3 - HBase Region Inspector</title>
<meta name="title" content="kakao의 오픈소스 Ep3 - HBase Region Inspector" />
<meta name="author" content="jg.choi"/>
<meta name="description" content="“카카오의 오픈소스를 소개합니다” 세번째는 jg.choi와 동료들이 개발한 HBase Region Inspector입니다. HBase Region Inspector는 HBase의 여러 리젼에 분산된 데이터를 시각적으로 보여주는 실용적인 도구입니다. 카카오에서도 대규모 HBase 클러스터 운영에 큰 도움이 되고 있는 유용한 소프트웨어입니다. 특히 Clojure 와 React으로 작성되어 Clojure를 공부하려는 개발자들에게 유용할 것입니다. HBase 카카오의 많은 서비스는 대용량의 데이터를 저장하고 서비스하기 위해 Apache HBase 를 사용하고 있습니다. HBase 는 이미 잘 알려져 있으니 긴 설명이 필요하진 않을 것 같은데요. 간단히 한 문장으로 요약하자면 HBase 는..."/>

<meta property="fb:app_id" content="1204347326263800"/>

<meta property="og:site_name" content="kakao 기술 블로그"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="kakao의 오픈소스 Ep3 - HBase Region Inspector"/>
<meta property="og:description" content="“카카오의 오픈소스를 소개합니다” 세번째는 jg.choi와 동료들이 개발한 HBase Region Inspector입니다. HBase Region Inspector는 HBase의 여러 리젼에 분산된 데이터를 시각적으로 보여주는 실용적인 도구입니다. 카카오에서도 대규모 HBase 클러스터 운영에 큰 도움이 되고 있는 유용한 소프트웨어입니다. 특히 Clojure 와 React으로 작성되어 Clojure를 공부하려는 개발자들에게 유용할 것입니다. HBase 카카오의 많은 서비스는 대용량의 데이터를 저장하고 서비스하기 위해 Apache HBase 를 사용하고 있습니다. HBase 는 이미 잘 알려져 있으니 긴 설명이 필요하진 않을 것 같은데요. 간단히 한 문장으로 요약하자면 HBase 는..."/>
<meta property="og:url" content="http://localhost:4000/2016/03/11/opensource-3-hri/"/>
<meta property="og:image" content="http://localhost:4000/files/covers/offcuts.jpg"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="kakao의 오픈소스 Ep3 - HBase Region Inspector"/>
<meta name="twitter:description" content="“카카오의 오픈소스를 소개합니다” 세번째는 jg.choi와 동료들이 개발한 HBase Region Inspector입니다. HBase Region Inspector는 HBase의 여러 리젼에 분산된 데이터를 시각적으로 보여주는 실용적인 도구입니다. 카카오에서도 대규모 HBase 클러스터 운영에 큰 도움이 되고 있는 유용한 소프트웨어입니다. 특히 Clojure 와 React으로 작성되어 Clojure를 공부하려는 개발자들에게 유용할 것입니다. HBase 카카오의 많은 서비스는 대용량의 데이터를 저장하고 서비스하기 위해 Apache HBase 를 사용하고 있습니다. HBase 는 이미 잘 알려져 있으니 긴 설명이 필요하진 않을 것 같은데요. 간단히 한 문장으로 요약하자면 HBase 는..."/>
<meta name="twitter:label1" content="Written by"/>
<meta name="twitter:data1" content="jg.choi"/>
<meta name="twitter:image:src" content="http://localhost:4000/files/covers/offcuts.jpg"/>

<meta name="twitter:label2" content="Filed under"/>
<meta name="twitter:data2" content="opensource,hbase-region-inspector,hri,hbase,clojure"/>

<meta property="article:tag" content="opensource"/>

<meta property="article:tag" content="hbase-region-inspector"/>

<meta property="article:tag" content="hri"/>

<meta property="article:tag" content="hbase"/>

<meta property="article:tag" content="clojure"/>



<meta property="article:published_time" content="2016-03-11T12:55:00+09:00"/>


<meta property="article:author" content="http://localhost:4000/authors/jg.choi"/>

<link href="http://localhost:4000/rss/" rel="alternate" type="application/rss+xml" title="RSS"/>
<link href="/assets/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon"/>
<link href="/assets/apple-touch-icon.png" rel="apple-touch-icon" type="image/png"/>
<link href="/assets/apple-touch-icon.png" rel="apple-touch-icon-precomposed" type="image/png"/>
<link href="/assets/lib/normalize.css" rel="stylesheet" type="text/css"/>
<link href="/assets/css/monokai.css" rel="stylesheet" type="text/css"/> 
<link href="/assets/lib/magnific-popup.min.css" rel="stylesheet" type="text/css"/>
<link href="/assets/fonts/Kakao.css" rel="stylesheet" type="text/css"/> 
<link href="/assets/css/screen.css" rel="stylesheet" type="text/css"/>
<script>
    if (window.location.host.indexOf('tech.kakao.com') > -1 && window.location.protocol == "https:"){
        window.location = window.location.toString().replace(/^https:/, "http:");
    }
</script>

</head>
<body class="post-template">

<div id="header">
    <button id="menu-toggle" type="button">
        <span class="sr-only">Toggle Navigation Menu</span>
    </button>
    <button id="search-toggle" type="button">
        <span class="sr-only">Toggle Search Form</span>
    </button>
    <a id="logo" href="/">
        <span class="sr-only">KakaoTech</span>
    </a>
    <div id="search">
        <input id="search-input" type="search" placeholder="Search..." value="" />
    </div>
    <ul class="search__results" id="results-container"></ul>

    <ul id="menu" class="nav">
        <li class=" active "><a href="/">블로그</a></li>
        <li class=""><a href="/opensource/">오픈소스</a></li>
        <li class=""><a href="/openapi/">오픈API</a></li>
        <li class=""><a href="/events/">기술행사</a></li>
    </ul>
</div>
<!-- Script pointing to jekyll-search.js -->
<script src="/dest/jekyll-search.js" type="text/javascript"></script>

<script type="text/javascript">
    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '/search2.json',
        searchResultTemplate: '<li><a href="{url}" title="{desc}">{title}</a></li>',
        noResultsText: '<li>No results found</li>',
        limit: 15,
        fuzzy: false,
        exclude: ['Welcome']
    })
</script><!-- #header -->



<div id="wrapper">
    <div id="navbar" class="container">
  <h5><a id="link-back" href="/">Back to Posts</a></h5>
  
<ul id="shares">
    <li class="stalk" style="display:none">
        <a id="kakao-link-btn" href="javascript:;"></a>
    </li>
    <li>
        <a id="share-kakaostory" href="javascript:shareStory('http://localhost:4000/2016/03/11/opensource-3-hri/');"></a>
    </li>

    
    <li>
        <a id="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2016/03/11/opensource-3-hri/"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <span class="sr-only">Share to Facebook</span>
        </a>
    </li>
    
    
    <li>
        <a id="share-twitter"
           href="https://twitter.com/intent/tweet?text=kakao%EC%9D%98%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%20Ep3%20-%20HBase%20Region%20Inspector&url=http://localhost:4000/2016/03/11/opensource-3-hri/">
            <span class="sr-only">Share to Twitter</span>
        </a>
    </li>
    
    
    <li>
        <a id="share-google" href="https://plus.google.com/share?url=http://localhost:4000/2016/03/11/opensource-3-hri/"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
            <span class="sr-only">Share to Google+</span>
        </a>
    </li>
    
</ul>

</div>

<div id="cover" class="container" style="background-image: url(/files/covers/offcuts.jpg);" >
  <div>
    <h1>kakao의 오픈소스 Ep3 - HBase Region Inspector</h1>
    <p>
      
      <a href="/tags/opensource">opensource</a>
      ,
      
      <a href="/tags/hbase-region-inspector">hbase-region-inspector</a>
      ,
      
      <a href="/tags/hri">hri</a>
      ,
      
      <a href="/tags/hbase">hbase</a>
      ,
      
      <a href="/tags/clojure">clojure</a>
      
      
    </p>
    


  </div>
</div>

<div id="content" class="container post" role="main">
  <div id="post-content"><p><a id="forkme" href="https://github.com/kakao/hbase-region-inspector"></a></p>

<blockquote>
  <p>“카카오의 오픈소스를 소개합니다” 세번째는 <a href="https://github.com/junegunn">jg.choi</a>와 동료들이 개발한 <strong>HBase Region Inspector</strong>입니다.</p>

  <p><a href="https://github.com/kakao/hbase-region-inspector">HBase Region Inspector</a>는 HBase의 여러 리젼에 분산된 데이터를 시각적으로 보여주는 실용적인 도구입니다.</p>

  <p>카카오에서도 대규모 HBase 클러스터 운영에 큰 도움이 되고 있는 유용한 소프트웨어입니다. 특히 <a href="http://clojure.org/">Clojure</a> 와 <a href="https://facebook.github.io/react/">React</a>으로 작성되어 Clojure를 공부하려는 개발자들에게 유용할 것입니다.</p>
</blockquote>

<h3 id="hbase">HBase</h3>

<p>카카오의 많은 서비스는 대용량의 데이터를 저장하고 서비스하기 위해 <a href="https://hbase.apache.org/">Apache HBase</a> 를 사용하고 있습니다.</p>

<p>HBase 는 이미 잘 알려져 있으니 긴 설명이 필요하진 않을 것 같은데요. 간단히 한 문장으로 요약하자면 HBase 는 데이터를 여러 서버에 분산 저장하고 처리하는 Hadoop 기반의 분산 데이터 저장소입니다.</p>

<h3 id="region-데이터-분산의-단위">Region: 데이터 분산의 단위</h3>

<p>분산 데이터 저장소이니 당연히 데이터가 여러 서버에 잘 분산 되어 있어야
scalable 한 성능을 얻을 수 있죠. HBase 는 각 테이블 데이터를 여러 구간으로 나누는데 – RDBMS 의 range partitioning 과 동일한 방식 – 이렇게 나눈 각 구간의 데이터를 리젼 (region) 이라 부르고 분산의 기본 단위로 사용합니다. 다른 데이터 스토어에서는 유사한 개념을 partition, chunk 등의 명칭으로 부르기도 합니다.</p>

<p><img src="/files/hri-range-partition.png" alt="리젼의 개념" /></p>

<p>(이미지 출처: <a href="http://www.cyanny.com/2014/03/13/hbase-architecture-analysis-part1-logical-architecture/">HBase Architecture Analysis Part1(Logical Architecture)</a>)</p>

<p>HBase 클러스터 성능 관리의 핵심은 바로 이런 리젼들의 분산을 모니터링하고 관리하는 일입니다. 리젼들이 적절한 크기로, 또 적절한 범위로 나뉘어져 있는지, 모든 서버에 고르게 분산되어 있는지, 읽기나 쓰기가 몰린 리젼이 있지는 않은지, 특정 리젼 서버에 요청이 많은 리젼들이 다수 배치되어 있지는 않은지, 다양한 관점에서 살펴봐야 하죠.</p>

<p>그런데 안타깝게도 HBase 의 Web UI 를 통해서는 이러한 사항들을 효과적으로 파악하기가 힘듭니다. 각 리젼 서버는 다음과 같은 단순한 화면만을 제공하거든요.</p>

<p><img src="/files/hri-metrics.png" alt="" /></p>

<p>지표들을 visual 하게 보여주지 않고 숫자로만 보여주니 상대적인 크고 작음이 머리 속에 잘 그려지지 않습니다. 읽기/쓰기 요청 수도 누적 횟수만 보여줄 뿐, 실제로 중요한 초당 요청 횟수를 보여주지는 않아요.</p>

<p>가장 큰 문제는 모아서 볼 수 없다는 점입니다. HBase 클러스터를 구성하는 서버의 대수가 수십대, 수백대를 넘어가는 경우에, 그 모든 서버들의 페이지를 일일이 열어 가며 확인 할 수는 없는 노릇이죠. 클러스터 전체 리젼들의 상태를 한 눈에 조망할 수 있는 방법이 없었습니다.</p>

<h3 id="오픈소스-툴은-없을까">오픈소스 툴은 없을까?</h3>

<p>분명 비슷한 아쉬움을 느낀 사람들이 있었겠죠. <a href="https://github.com/sentric/hannibal">Hannibal</a> 이라는 오픈소스 모니터링 툴이 있습니다. 다음과 같이 각 리젼 서버에 위치한 리젼들의 크기를 visual 하게 보여줍니다.</p>

<p><img src="/files/hri-hannibal-servers.png" alt="Hannibal 서버 모니터링 화면" /></p>

<p>![<a href="/files/hri-hannibal-regions.png">Hannibal 리젼 모니터링 화면</a></p>

<p>좋은 시도인 것은 분명하나 단순히 리젼의 크기 정보만을 보여줄 뿐이라 많은 통찰을 주지는 못합니다. 더 이상 <a href="https://github.com/sentric/hannibal/commits/next">업데이트 되지 않고</a> 있기도 합니다.</p>

<h3 id="그래서-만든-hbase-region-inspector">그래서 만든 <a href="https://github.com/kakao/hbase-region-inspector">hbase-region-inspector</a></h3>

<p>그래서 결국 <a href="https://github.com/kakao/hbase-region-inspector">hbase-region-inspector</a> 라는 (밋밋한 이름의) 툴을 만들기로 했습니다. 목표로 했던 것은 다음과 같습니다.</p>

<ul>
  <li>클러스터의 전체적인 상태를 한눈에 조망할 수 있을 것</li>
  <li>다양한 지표를 확인할 수 있을 것</li>
  <li>필요 시 리젼을 옮길 수 있을 것</li>
  <li>설치하고 사용하기 쉬울 것</li>
</ul>

<p>프로젝트는 빠른 개발을 위해 <a href="http://clojure.org/">Clojure</a> 와 <a href="https://facebook.github.io/react/">React</a> 을 이용해 구현되었습니다. Clojure 에 관심이 많은 분이라면 왜 <a href="https://github.com/omcljs/om">Om</a> 이나 <a href="https://github.com/reagent-project/reagent">Reagent</a> 를 사용하지 않았는지 궁금해 하실 지도 모르겠네요. 그건 단순히 필자가 JavaScript 개발자가 아닌데다 React 도 처음 써보는 입장이라 추상화 계층을 하나 더 두기는 부담스러워서 그랬던 것이죠.</p>

<h3 id="사용법">사용법</h3>

<p>hbase-region-inspector 는 <a href="https://github.com/kakao/hbase-region-inspector/releases">실행 가능한 바이너리 또는 JAR 의 형태로 배포</a>되고 있습니다. 사용하시는 클러스터에 맞는 바이너리 파일을 다운로드 하시고 실행 권한을 부여하신 후 (<code class="highlighter-rouge">chmod +x ...</code>), 다음과 같이 실행하시면 됩니다.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./hbase-region-inspector ZOOKEEPER_QUORUM HTTP_PORT <span class="o">[</span>INTERVAL]
</code></pre></div></div>

<p>쉽죠?</p>

<h3 id="실행-화면">실행 화면</h3>

<p>지정한 포트를 브라우저에서 열어보시면 다음과 같은 화면을 보실 수 있습니다.</p>

<p><img src="https://github.com/kakao/hbase-region-inspector/raw/master/screenshot/hbase-region-inspector.png" alt="" /></p>

<p>각 리젼 서버별 리젼 분포와, 각 리젼의 크기, 누적 요청 수, 초당 요청 수, 스토어파일의 개수, 멤스토어의 크기 등 다양한 정보를 확인 할 수 있습니다.</p>

<p>구체적인 동작은 아래의 영상에서 확인하세요.</p>

<h3 id="demo">Demo</h3>

<video autoplay="" loop="" muted="" controls="true" preload="metadata" crossorigin="anonymous" style="width:100%;">
            <source src="/files/hri.webm" type="video/webm" />
            <source src="/files/hri.ogv" type="video/ogg" />
            <source src="/files/hri.mp4" type="video/mp4" />
</video>

<h3 id="활용-사례">활용 사례</h3>

<p>사용하기 쉽다 보니 카카오에서는 여러 팀에서 이 툴을 사용해 HBase 상태를 모니터링하고 있습니다. 웹서버의 형태로 실행되므로, 현재 상태를 공유하기에도 편리하죠. 다양한 문제 상황에 대한 진단과 파악도 용이해졌는데요, 실제로 다음과 같은 사례들을 진단하는데 활용했습니다.</p>

<ul>
  <li>특정 리젼에 과도하게 많은 요청이 몰리고 있는 상황</li>
  <li>리젼 개수 기준으로는 고르게 분산되었지만, 요청 횟수는 특정 서버에 쏠린 상황</li>
  <li>Rowkey 를 잘못 만들어 의도와는 다르게 특정 리젼의 사이즈만 커진 상황</li>
</ul>

<h3 id="한계">한계</h3>

<p>아직 몇 가지 아쉬운 점들이 있기는 합니다. hbase-region-inspector 는 현재 현황을 파악하는데는 도움이 되지만, 변화 이력을 추적하기에는 적합하지 않습니다 (3차원 그래프가 필요할까요?).</p>

<p>또한 리젼의 개수가 수만개를 넘어가는 대형 클러스터를 대상으로 실행하는 경우, 브라우저가 무척이나 힘들어 하는 모습을 보게 됩니다.</p>

<p><img src="/files/hri-chrome.png" alt="" /></p>

<p>(미안 크롬 …)</p>

<h3 id="오픈소스">오픈소스</h3>

<p>자랑할 만한 수준의 코드는 아니지만 – 아니 사실 그 반대이지만 – 다른 HBase 사용자 분들께도 유용하리라는 판단에 오픈소스로 공개하게 되었습니다. 소스코드와 바이너리는 아래 링크에서 보실 수 있습니다.</p>

<ul>
  <li>https://github.com/kakao/hbase-region-inspector</li>
  <li>https://github.com/kakao/hbase-region-inspector/releases</li>
</ul>

<p>사용해 보시고 피드백 주세요. 저의 비루한 JavaScript 코드를 다듬어 주실 분도 기다려 봅니다.</p>

<ul>
  <li>커버 이미지 출처: <a href="https://flic.kr/p/s3Q7rD">Offcuts</a> © <a href="https://www.flickr.com/photos/andrewgustar/">Andrew Gustar
</a></li>
</ul>
</div>
  <div id="post-footer">
    
    <a id="post-author" href="/authors/jg.choi/">
      <div id="author-image" style="background-image:url(/files/authors/jg.choi.jpg);">
        <span class="sr-only">jg.choi's profile image</span>
      </div>
      <p id="author-name">jg.choi</p>
    </a>
    <p id="post-date">2016-03-11 12:55</p>
    <a id="post-more" href="/authors/jg.choi/">
      <span>Read more posts by this author</span>
    </a>
  </div>
</div>

<div class="container" style="margin-top:25px; padding:0px">
  <a href="https://www.welcomekakao.com" target="_blank"><img src="/files/career2020.jpg" style="width:100%;"></a>
</div>

<div id="post-links" class="container">
  
  
  <div id="post-prev" style="background-image: url(/files/covers/observatory.jpg);" >
    <div>
      <h3><a href="/2016/03/11/redis-scan/">Redis의 SCAN은 어떻게 동작하는가?</a></h3>
      <p>YOU MIGHT ENJOY</p>
    </div>
  </div>
  
  
  
  <div id="post-next" style="background-image: url(/files/covers/railway-switch.jpg);" >
    <div>
      <h3><a href="/2016/03/18/redis-ha-dns/">DNS 기반의 Redis HA 구현</a></h3>
      <p>NEXT POST</p>
    </div>
  </div>
  
</div>

<div id="lightbox">
  <div id="lightbox-image"></div>
</div>

    <div class="clearfix"></div>

    <a href="#" id="back-to-top"></a>
</div>

<div id="footer" class="container-fluid">
    <ul id="links">
        
        <li>
            <a id="link-github" href="http://github.com/kakao" target="_blank">
                <span class="sr-only">github</span>
            </a>
        </li>
        
        
        <li>
            <a id="link-facebook" href="http://facebook.com/nkakao" target="_blank">
                <span class="sr-only">facebook</span>
            </a>
        </li>
        
        
        <li>
            <a id="link-twitter" href="http://twitter.com/kakaodev" target="_blank">
                <span class="sr-only">twitter</span>
            </a>
        </li>
        
        <li>
            <a id="link-rss" href="/rss" target="_blank">
                <span class="sr-only">rss</span>
            </a>
        </li>
    </ul>
    <ul id="footer-menu">
        <li><a href="//www.kakaocorp.com">Kakao</a></li>
        <li><a href="//careers.kakao.com/jobs">Jobs</a></li>
        <li><a href="//privacy.kakaocorp.com">Privacy</a></li>
    </ul>
    <p id="copyright">
        <a href="//www.kakaocorp.com">Copyright &copy; Kakao Corp.</a>
        All rights reserved.
    </p>
</div><!--#footer-->


<script src="/assets/lib/jquery-1.12.0.min.js"></script>
<script src="/assets/lib/jquery.magnific-popup.min.js"></script>
<script src="/assets/js/index.js"></script>
<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>


<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-72007721-1', 'auto');
    ga('send', 'pageview');
</script>




    <script type='text/javascript'>
   //<![CDATA[
    // 사용할 앱의 JavaScript 키를 설정해 주세요.
    //Kakao.init('65d48e116d8b9409e08960c4800c3017');
    function shareStory(abs_page_url) {
        Kakao.Story.share({
            url: abs_page_url,
            text: '카카오 기술블로그 #개발자 #카카오'
        });
    }
    //]]>
</script>

    
    <script>
window.fbAsyncInit = function() {
  FB.init({
    appId      : '1204347326263800',
    xfbml      : true,
    version    : 'v2.7'
  });
};

(function(d, s, id){
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>

    

    
    <script>!function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
        if (!d.getElementById(id)) {
            js = d.createElement(s);
            js.id = id;
            js.src = p + '://platform.twitter.com/widgets.js';
            fjs.parentNode.insertBefore(js, fjs);
        }
    }(document, 'script', 'twitter-wjs');
</script>

    

    
    <script src="https://apis.google.com/js/platform.js" async defer>
    {
        lang: 'ko'
    }
</script>

    

</body>
</html>
