<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no"/>


<title>kakao의 오픈소스 Ep6 - Cite</title>
<meta name="title" content="kakao의 오픈소스 Ep6 - Cite" />
<meta name="author" content="niko.bellic"/>
<meta name="description" content="“카카오의 오픈소스를 소개합니다” 여섯번째는 niko.bellic이 개발한 Cite입니다. Cite는 Container as a Service(CaaS)로서 소스코드를 빌드하고 배포하며 운영하는 일련의 과정을 자동화하는 웹 서비스입니다. Introduction Cite는 google kubernetes기반 CaaS(Container as a Service)입니다. Kubernetes는 최근 Container Orchestrator로 각광받고 있지만 설치와 운영이 복잡하기 때문에 익혀서 사용하기 위해서는 많은 시간과 노력을 필요로 합니다. Cite는 이러한 어려움을 줄이기 위해 Kubernetes Cluster를 사전에 생성하고 실제 서비스 담당 개발자가 Kubernetes Cluster로 서비스 배포/롤백 등을 할 수 있도록 Kubernetes와 GitHub을 연동하였습니다. Why Cite? Fast IT..."/>

<meta property="fb:app_id" content="1204347326263800"/>

<meta property="og:site_name" content="kakao 기술 블로그"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="kakao의 오픈소스 Ep6 - Cite"/>
<meta property="og:description" content="“카카오의 오픈소스를 소개합니다” 여섯번째는 niko.bellic이 개발한 Cite입니다. Cite는 Container as a Service(CaaS)로서 소스코드를 빌드하고 배포하며 운영하는 일련의 과정을 자동화하는 웹 서비스입니다. Introduction Cite는 google kubernetes기반 CaaS(Container as a Service)입니다. Kubernetes는 최근 Container Orchestrator로 각광받고 있지만 설치와 운영이 복잡하기 때문에 익혀서 사용하기 위해서는 많은 시간과 노력을 필요로 합니다. Cite는 이러한 어려움을 줄이기 위해 Kubernetes Cluster를 사전에 생성하고 실제 서비스 담당 개발자가 Kubernetes Cluster로 서비스 배포/롤백 등을 할 수 있도록 Kubernetes와 GitHub을 연동하였습니다. Why Cite? Fast IT..."/>
<meta property="og:url" content="http://localhost:4000/2016/12/26/opensource-6-cite/"/>
<meta property="og:image" content="http://localhost:4000/assets/images/default_blog_cover.jpg"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="kakao의 오픈소스 Ep6 - Cite"/>
<meta name="twitter:description" content="“카카오의 오픈소스를 소개합니다” 여섯번째는 niko.bellic이 개발한 Cite입니다. Cite는 Container as a Service(CaaS)로서 소스코드를 빌드하고 배포하며 운영하는 일련의 과정을 자동화하는 웹 서비스입니다. Introduction Cite는 google kubernetes기반 CaaS(Container as a Service)입니다. Kubernetes는 최근 Container Orchestrator로 각광받고 있지만 설치와 운영이 복잡하기 때문에 익혀서 사용하기 위해서는 많은 시간과 노력을 필요로 합니다. Cite는 이러한 어려움을 줄이기 위해 Kubernetes Cluster를 사전에 생성하고 실제 서비스 담당 개발자가 Kubernetes Cluster로 서비스 배포/롤백 등을 할 수 있도록 Kubernetes와 GitHub을 연동하였습니다. Why Cite? Fast IT..."/>
<meta name="twitter:label1" content="Written by"/>
<meta name="twitter:data1" content="niko.bellic"/>
<meta name="twitter:image:src" content="http://localhost:4000/assets/images/default_blog_cover.jpg"/>

<meta name="twitter:label2" content="Filed under"/>
<meta name="twitter:data2" content="opensource,cite,kubernetes,github,docker,container,microservice"/>

<meta property="article:tag" content="opensource"/>

<meta property="article:tag" content="cite"/>

<meta property="article:tag" content="kubernetes"/>

<meta property="article:tag" content="github"/>

<meta property="article:tag" content="docker"/>

<meta property="article:tag" content="container"/>

<meta property="article:tag" content="microservice"/>



<meta property="article:published_time" content="2016-12-26T17:00:00+09:00"/>


<meta property="article:author" content="http://localhost:4000/authors/niko.bellic"/>

<link href="http://localhost:4000/rss/" rel="alternate" type="application/rss+xml" title="RSS"/>
<link href="/assets/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon"/>
<link href="/assets/apple-touch-icon.png" rel="apple-touch-icon" type="image/png"/>
<link href="/assets/apple-touch-icon.png" rel="apple-touch-icon-precomposed" type="image/png"/>
<link href="/assets/lib/normalize.css" rel="stylesheet" type="text/css"/>
<link href="/assets/css/monokai.css" rel="stylesheet" type="text/css"/> 
<link href="/assets/lib/magnific-popup.min.css" rel="stylesheet" type="text/css"/>
<link href="/assets/fonts/Kakao.css" rel="stylesheet" type="text/css"/> 
<link href="/assets/css/screen.css" rel="stylesheet" type="text/css"/>
<script>
    if (window.location.host.indexOf('tech.kakao.com') > -1 && window.location.protocol == "https:"){
        window.location = window.location.toString().replace(/^https:/, "http:");
    }
</script>

</head>
<body class="post-template">

<div id="header">
    <button id="menu-toggle" type="button">
        <span class="sr-only">Toggle Navigation Menu</span>
    </button>
    <button id="search-toggle" type="button">
        <span class="sr-only">Toggle Search Form</span>
    </button>
    <a id="logo" href="/">
        <span class="sr-only">KakaoTech</span>
    </a>
    <div id="search">
        <input id="search-input" type="search" placeholder="Search..." value="" />
    </div>
    <ul class="search__results" id="results-container"></ul>

    <ul id="menu" class="nav">
        <li class=" active "><a href="/">블로그</a></li>
        <li class=""><a href="/opensource/">오픈소스</a></li>
        <li class=""><a href="/openapi/">오픈API</a></li>
        <li class=""><a href="/events/">기술행사</a></li>
    </ul>
</div>
<!-- Script pointing to jekyll-search.js -->
<script src="/dest/jekyll-search.js" type="text/javascript"></script>

<script type="text/javascript">
    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '/search2.json',
        searchResultTemplate: '<li><a href="{url}" title="{desc}">{title}</a></li>',
        noResultsText: '<li>No results found</li>',
        limit: 15,
        fuzzy: false,
        exclude: ['Welcome']
    })
</script><!-- #header -->



<div id="wrapper">
    <div id="navbar" class="container">
  <h5><a id="link-back" href="/">Back to Posts</a></h5>
  
<ul id="shares">
    <li class="stalk" style="display:none">
        <a id="kakao-link-btn" href="javascript:;"></a>
    </li>
    <li>
        <a id="share-kakaostory" href="javascript:shareStory('http://localhost:4000/2016/12/26/opensource-6-cite/');"></a>
    </li>

    
    <li>
        <a id="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2016/12/26/opensource-6-cite/"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <span class="sr-only">Share to Facebook</span>
        </a>
    </li>
    
    
    <li>
        <a id="share-twitter"
           href="https://twitter.com/intent/tweet?text=kakao%EC%9D%98%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%20Ep6%20-%20Cite&url=http://localhost:4000/2016/12/26/opensource-6-cite/">
            <span class="sr-only">Share to Twitter</span>
        </a>
    </li>
    
    
    <li>
        <a id="share-google" href="https://plus.google.com/share?url=http://localhost:4000/2016/12/26/opensource-6-cite/"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
            <span class="sr-only">Share to Google+</span>
        </a>
    </li>
    
</ul>

</div>

<div id="cover" class="container" >
  <div>
    <h1>kakao의 오픈소스 Ep6 - Cite</h1>
    <p>
      
      <a href="/tags/opensource">opensource</a>
      ,
      
      <a href="/tags/cite">cite</a>
      ,
      
      <a href="/tags/kubernetes">kubernetes</a>
      ,
      
      <a href="/tags/github">github</a>
      ,
      
      <a href="/tags/docker">docker</a>
      ,
      
      <a href="/tags/container">container</a>
      ,
      
      <a href="/tags/microservice">microservice</a>
      
      
    </p>
    


  </div>
</div>

<div id="content" class="container post" role="main">
  <div id="post-content"><p><a id="forkme" href="https://github.com/kakao/cite"></a></p>

<blockquote>
  <p>“카카오의 오픈소스를 소개합니다” 여섯번째는 <a href="https://github.com/code0x9">niko.bellic</a>이 개발한 <strong>Cite</strong>입니다.</p>

  <p><a href="https://github.com/kakao/cite">Cite</a>는 Container as a Service(CaaS)로서 소스코드를 빌드하고 배포하며 운영하는 일련의 과정을 자동화하는 웹 서비스입니다.</p>
</blockquote>

<h2 id="introduction">Introduction</h2>

<p><a href="https://github.com/kakao/cite">Cite</a>는 google kubernetes기반 CaaS(Container as a Service)입니다.</p>

<p>Kubernetes는 최근 Container Orchestrator로 각광받고 있지만 설치와 운영이 복잡하기 때문에 익혀서 사용하기 위해서는 많은 시간과 노력을 필요로 합니다.</p>

<p><img src="/files/cite-google-trends-container_orchestrators.png" alt="Google Trends on Major Container Orchestrators" /></p>

<p>Cite는 이러한 어려움을 줄이기 위해 Kubernetes Cluster를 사전에 생성하고 실제 서비스 담당 개발자가 Kubernetes Cluster로 서비스 배포/롤백 등을 할 수 있도록 Kubernetes와 GitHub을 연동하였습니다.</p>

<h2 id="why-cite">Why Cite?</h2>

<ul>
  <li>Fast IT
    <ul>
      <li>더 빠르게 서비스를 생성/배포/롤백합니다. 가능한 모든 부분을 자동화!</li>
      <li>빠르게 확장(horizontal/vertical scaling)할 수 있습니다.</li>
    </ul>
  </li>
  <li>Efficient IT
    <ul>
      <li>더 적은 하드웨어로 더 많은 서비스를 수행합니다.</li>
      <li>서비스 개발자와 SE의 인프라 관리 비용을 줄입니다.</li>
    </ul>
  </li>
</ul>

<h2 id="workflow">Workflow</h2>

<p>Cite에서의 서비스 배포는 아래의 흐름을 따릅니다.</p>

<p><img src="/files/cite-workflow.png" alt="Cite Workflow" /></p>

<!-- https://www.websequencediagrams.com/ source
title Cite Workflow

participant User
participant GitHub
participant Cite
participant Kubernetes
participant LoadBalancer
participant BuildBot

User->Cite: 서비스 생성
Cite->Kubernetes: kubernetes namespace 생성
note left of Kubernetes: github org => kubernetes namespace
Cite->GitHub: github webhook 생성
Cite->GitHub: repository에 collaborator 추가
Cite->Kubernetes: kubernetes 서비스 생성
note left of Kubernetes: github branch+reponame => kubernetes service name
Kubernetes->LoadBalancer: loadbalancer 생성
note right of LoadBalancer: 새 서비스가 생성될 때 LB인스턴스 생성

User->GitHub: git push
GitHub->Cite: push 이벤트
Cite->BuildBot: docker 빌드 요청
BuildBot->BuildBot: docker build & push
BuildBot->GitHub: status 이벤트: success
GitHub->Cite: status 이벤트
Cite->Kubernetes: kubernetes replication controller생성
Cite->Cite: RC와 Pod들이 Ready상태가 될때까지 대기
Cite->Kubernetes: 서비스 selector 갱신
Kubernetes->LoadBalancer: loadbalancer 갱신
note right of LoadBalancer: 서비스의 selector가 변경될 때 LB인스턴스 갱신
-->

<p>빌드, 배포, 롤백 등 각 서비스의 상태는 github commit status와 deployment status 이벤트를 통해 처리하며, LoadBalancer는 Kubernetes를 watch하여 각 서비스의 상태가 변경될 때 loadbalancer의 upstream을 변경합니다.</p>

<p>Cite에서는 Kubernetes에 내장된 rolling-upgrade 베포 방식이 아닌 A-B switching방식을 선택하였습니다. A-B switching은 배포시 새 컨테이너를 모두 구동한 후 loadbalancer에서 새 서비스의 upstream을 사용하도록 변경하는 방식인데요, 이 방식은 rolling-upgrade에 비해 배포시 리소스 사용량은 많지만 배포 이후에도 일정 기간 기존 컨테이너가 구동중이기 때문에 롤백이 빠르다는 장점이 있습니다. Cite는 주기적으로 1시간 이상 사용되지 않는 - service selector에 등록되지 않은 - 컨테이너를 종료하고 있습니다.</p>

<h2 id="현황-20161227">현황 (2016.12.27)</h2>

<ul>
  <li>Kubernetes Cluster
    <ul>
      <li>etcd, master : 물리장비 x 3대</li>
      <li>nodes : 물리장비 x 10대</li>
      <li>elasticsearch : 물리장비 x 4대 + 가상머신 3대</li>
      <li>loadbalancer : Citrix NetScaler active/standby</li>
    </ul>
  </li>
  <li>Kubernetes Services
    <ul>
      <li>service : 184개</li>
      <li>pod : 332개</li>
    </ul>
  </li>
  <li>전체 물리장비 현황</li>
</ul>

<p><img src="/files/cite-cluster-stats.png" alt="Cite Cluster Stats" /></p>

<ul>
  <li>node 1의 24시간 현황</li>
</ul>

<p><img src="/files/cite-node1-stats.png" alt="Cite Node1 Stats" /></p>

<h2 id="적용-사례--skraper-by-pjvegan">적용 사례 : skraper (by <a href="mailto:pj.vegan@kakaocorp.com">pj.vegan</a>)</h2>

<p>skraper는 카카오톡, 스토리 등 서비스에서 URL을 입력받고 해당 URL을 방문하여 대표 이미지를 추출한 후 반환하는 서비스입니다. skraper는 최초의 cite를 이용한 퍼블릭 서비스로 현재 cite에서 컨테이너 5 + 10개로 구동중입니다.</p>

<h2 id="reference">Reference</h2>

<ul>
  <li>GitHub Enterprise API : <a href="https://developer.github.com/enterprise/2.8/v3/">https://developer.github.com/enterprise/2.8/v3/</a></li>
  <li>Kubernetes Documents : <a href="http://kubernetes.io/docs/">http://kubernetes.io/docs/</a></li>
  <li>Docker Documents : <a href="https://docs.docker.com/">https://docs.docker.com/</a></li>
</ul>

<h2 id="see-also">See also</h2>
<ul>
  <li>Cite Documents : <a href="http://tech.kakao.com/docs-cite/">http://tech.kakao.com/docs-cite/</a></li>
</ul>
</div>
  <div id="post-footer">
    
    <a id="post-author" href="/authors/niko.bellic/">
      <div id="author-image" style="background-image:url(/files/authors/niko.bellic.jpg);">
        <span class="sr-only">niko.bellic's profile image</span>
      </div>
      <p id="author-name">niko.bellic</p>
    </a>
    <p id="post-date">2016-12-26 17:00</p>
    <a id="post-more" href="/authors/niko.bellic/">
      <span>Read more posts by this author</span>
    </a>
  </div>
</div>

<div class="container" style="margin-top:25px; padding:0px">
  <a href="https://www.welcomekakao.com" target="_blank"><img src="/files/career2020.jpg" style="width:100%;"></a>
</div>

<div id="post-links" class="container">
  
  
  <div id="post-prev" style="background-image: url(/files/covers/blog.jpg);" >
    <div>
      <h3><a href="/2016/08/25/kemi/">카카오의 전사 리소스 모니터링 시스템 - KEMI(Kakao Event Metering & monItoring)</a></h3>
      <p>YOU MIGHT ENJOY</p>
    </div>
  </div>
  
  
  
  <div id="post-next" >
    <div>
      <h3><a href="/2017/01/09/daummovie-rxjs/">RxJS - Daum영화에 적용하다</a></h3>
      <p>NEXT POST</p>
    </div>
  </div>
  
</div>

<div id="lightbox">
  <div id="lightbox-image"></div>
</div>

    <div class="clearfix"></div>

    <a href="#" id="back-to-top"></a>
</div>

<div id="footer" class="container-fluid">
    <ul id="links">
        
        <li>
            <a id="link-github" href="http://github.com/kakao" target="_blank">
                <span class="sr-only">github</span>
            </a>
        </li>
        
        
        <li>
            <a id="link-facebook" href="http://facebook.com/nkakao" target="_blank">
                <span class="sr-only">facebook</span>
            </a>
        </li>
        
        
        <li>
            <a id="link-twitter" href="http://twitter.com/kakaodev" target="_blank">
                <span class="sr-only">twitter</span>
            </a>
        </li>
        
        <li>
            <a id="link-rss" href="/rss" target="_blank">
                <span class="sr-only">rss</span>
            </a>
        </li>
    </ul>
    <ul id="footer-menu">
        <li><a href="//www.kakaocorp.com">Kakao</a></li>
        <li><a href="//careers.kakao.com/jobs">Jobs</a></li>
        <li><a href="//privacy.kakaocorp.com">Privacy</a></li>
    </ul>
    <p id="copyright">
        <a href="//www.kakaocorp.com">Copyright &copy; Kakao Corp.</a>
        All rights reserved.
    </p>
</div><!--#footer-->


<script src="/assets/lib/jquery-1.12.0.min.js"></script>
<script src="/assets/lib/jquery.magnific-popup.min.js"></script>
<script src="/assets/js/index.js"></script>
<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>


<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-72007721-1', 'auto');
    ga('send', 'pageview');
</script>




    <script type='text/javascript'>
   //<![CDATA[
    // 사용할 앱의 JavaScript 키를 설정해 주세요.
    //Kakao.init('65d48e116d8b9409e08960c4800c3017');
    function shareStory(abs_page_url) {
        Kakao.Story.share({
            url: abs_page_url,
            text: '카카오 기술블로그 #개발자 #카카오'
        });
    }
    //]]>
</script>

    
    <script>
window.fbAsyncInit = function() {
  FB.init({
    appId      : '1204347326263800',
    xfbml      : true,
    version    : 'v2.7'
  });
};

(function(d, s, id){
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>

    

    
    <script>!function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
        if (!d.getElementById(id)) {
            js = d.createElement(s);
            js.id = id;
            js.src = p + '://platform.twitter.com/widgets.js';
            fjs.parentNode.insertBefore(js, fjs);
        }
    }(document, 'script', 'twitter-wjs');
</script>

    

    
    <script src="https://apis.google.com/js/platform.js" async defer>
    {
        lang: 'ko'
    }
</script>

    

</body>
</html>
